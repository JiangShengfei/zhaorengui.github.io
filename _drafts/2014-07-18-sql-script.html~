<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org2b1dc69">1. 写在前面</a></li>
<li><a href="#org152396f">2. 常用SQL语句</a>
<ul>
<li><a href="#org3c44932">2.1. Table</a></li>
<li><a href="#org18247a9">2.2. 增删改查/清空</a></li>
<li><a href="#orgf10fb87">2.3. 索引/视图/事务处理/存储过程</a></li>
<li><a href="#orgd28957f">2.4. 触发器/游标</a></li>
</ul>
</li>
<li><a href="#org74e3c3f">3. 高级查询</a>
<ul>
<li><a href="#org9fe987b">3.1. 以某个字段进行分组查询，每组前n条记录</a></li>
<li><a href="#org643e2c1">3.2. 根据当天日期判断使用哪个字段排序（case&#x2026;when&#x2026;else&#x2026;end）</a></li>
<li><a href="#org66f0acf">3.3. 分组获取记录的第一条数据</a></li>
</ul>
</li>
<li><a href="#org90b38a2">4. 其他操作</a>
<ul>
<li><a href="#org2506998">4.1. 使用SQL语句清空数据库中所有表的数据</a></li>
<li><a href="#org8313ca5">4.2. SQL Server修改表名前的用户</a></li>
</ul>
</li>
<li><a href="#org8dbf303">5. 写在最后</a></li>
</ul>
</div>
</div>
<p>
Welcome you to mail to zrg1390556487@gmail.com, Thank you!!!
</p>

<div id="outline-container-org2b1dc69" class="outline-2">
<h2 id="org2b1dc69"><span class="section-number-2">1</span> 写在前面</h2>
<div class="outline-text-2" id="text-1">
<pre class="example">
SQL Script

</pre>
</div>
</div>
<div id="outline-container-org152396f" class="outline-2">
<h2 id="org152396f"><span class="section-number-2">2</span> 常用SQL语句</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org3c44932" class="outline-3">
<h3 id="org3c44932"><span class="section-number-3">2.1</span> Table</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-orgea25eff" class="outline-4">
<h4 id="orgea25eff"><span class="section-number-4">2.1.1</span> Create Table</h4>
<div class="outline-text-4" id="text-2-1-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #346604;">create</span> <span style="color: #346604;">table</span> <span style="color: #a40000;">TableName</span>(
id <span style="color: #204a87;">int</span>(10) <span style="color: #346604;">not</span> <span style="color: #346604;">null</span> <span style="color: #346604;">primary</span> <span style="color: #346604;">key</span> auto_increment,
<span style="color: #346604;">name</span> <span style="color: #204a87;">varchar</span>(20) <span style="color: #346604;">not</span> <span style="color: #346604;">null</span>,
password <span style="color: #204a87;">varchar</span>(45) <span style="color: #346604;">not</span> <span style="color: #346604;">null</span>,
sex <span style="color: #204a87;">int</span>(4) <span style="color: #346604;">not</span> <span style="color: #346604;">null</span> <span style="color: #346604;">default</span> <span style="color: #5c3566;">'0'</span>,
);
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd70128a" class="outline-4">
<h4 id="orgd70128a"><span class="section-number-4">2.1.2</span> Alter Table</h4>
<div class="outline-text-4" id="text-2-1-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #346604;">alter</span> <span style="color: #346604;">table</span> <span style="color: #a40000;">TableName</span> 
characiter <span style="color: #346604;">set</span>=utf8mb4,
<span style="color: #346604;">collate</span>=utf8mb4_general_ci
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org18247a9" class="outline-3">
<h3 id="org18247a9"><span class="section-number-3">2.2</span> 增删改查/清空</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org51e6a8e" class="outline-4">
<h4 id="org51e6a8e"><span class="section-number-4">2.2.1</span> 新增</h4>
<div class="outline-text-4" id="text-2-2-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #346604;">insert</span> <span style="color: #346604;">into</span> TableName(id,<span style="color: #346604;">name</span>,password) <span style="color: #346604;">values</span>(<span style="color: #5c3566;">'1'</span>,<span style="color: #5c3566;">'&#23385;&#24735;&#31354;'</span>,<span style="color: #5c3566;">'sduwe9uifsdddssdf23qfuieqwerq'</span>);
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb10459f" class="outline-4">
<h4 id="orgb10459f"><span class="section-number-4">2.2.2</span> 删除</h4>
<div class="outline-text-4" id="text-2-2-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #346604;">delete</span> <span style="color: #346604;">from</span> TableName <span style="color: #346604;">where</span> id=<span style="color: #5c3566;">'1'</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcc22388" class="outline-4">
<h4 id="orgcc22388"><span class="section-number-4">2.2.3</span> 修改</h4>
<div class="outline-text-4" id="text-2-2-3">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #346604;">update</span> TableName <span style="color: #346604;">set</span> <span style="color: #346604;">name</span>=<span style="color: #5c3566;">'&#23385;&#24735;&#31354;'</span> <span style="color: #346604;">where</span> id=<span style="color: #5c3566;">'1'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org30c8acd" class="outline-4">
<h4 id="org30c8acd"><span class="section-number-4">2.2.4</span> 查询</h4>
<div class="outline-text-4" id="text-2-2-4">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #346604;">select</span> * <span style="color: #346604;">from</span> TableName;
<span style="color: #346604;">select</span> id,<span style="color: #346604;">name</span>,password <span style="color: #346604;">from</span> TableName;
</pre>
</div>
</div>
</div>
<div id="outline-container-org817e70d" class="outline-4">
<h4 id="org817e70d"><span class="section-number-4">2.2.5</span> 清空</h4>
<div class="outline-text-4" id="text-2-2-5">
<div class="org-src-container">
<pre class="src src-sql">truncate <span style="color: #346604;">table</span> TableName;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf10fb87" class="outline-3">
<h3 id="orgf10fb87"><span class="section-number-3">2.3</span> 索引/视图/事务处理/存储过程</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-org7943e5b" class="outline-4">
<h4 id="org7943e5b"><span class="section-number-4">2.3.1</span> 索引</h4>
</div>
<div id="outline-container-orge4e880d" class="outline-4">
<h4 id="orge4e880d"><span class="section-number-4">2.3.2</span> 视图</h4>
<div class="outline-text-4" id="text-2-3-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #346604;">create</span> <span style="color: #346604;">view</span> <span style="color: #a40000;">ViewName</span> <span style="color: #346604;">AS</span>
    <span style="color: #346604;">select</span> ...
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd28957f" class="outline-3">
<h3 id="orgd28957f"><span class="section-number-3">2.4</span> 触发器/游标</h3>
</div>
</div>
<div id="outline-container-org74e3c3f" class="outline-2">
<h2 id="org74e3c3f"><span class="section-number-2">3</span> 高级查询</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org9fe987b" class="outline-3">
<h3 id="org9fe987b"><span class="section-number-3">3.1</span> 以某个字段进行分组查询，每组前n条记录</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #346604;">select</span> res.* <span style="color: #346604;">from</span>(
 <span style="color: #346604;">select</span> * <span style="color: #346604;">from</span> View_ArticleChannel a
 <span style="color: #346604;">where</span> a.ID <span style="color: #346604;">in</span>(
    <span style="color: #346604;">select</span> top 3 ID <span style="color: #346604;">from</span> View_ArticleChannel <span style="color: #346604;">where</span> a.ChannelName=ChannelName <span style="color: #346604;">order</span> <span style="color: #346604;">by</span> a.ChannelName <span style="color: #346604;">DESC</span>
 )
) <span style="color: #346604;">as</span> res
<span style="color: #346604;">where</span> res.ChannelName <span style="color: #346604;">in</span>(<span style="color: #5c3566;">'&#29289;&#27969;&#20844;&#21496;'</span>,<span style="color: #5c3566;">'&#20113;&#20179;&#20844;&#21578;'</span>)
<span style="color: #5f615c; font-style: italic;">-- group by res.ID,res.ChannelName,res.Title</span>
<span style="color: #346604;">order</span> <span style="color: #346604;">by</span> res.ChannelName
</pre>
</div>
</div>
</div>
<div id="outline-container-org643e2c1" class="outline-3">
<h3 id="org643e2c1"><span class="section-number-3">3.2</span> 根据当天日期判断使用哪个字段排序（case&#x2026;when&#x2026;else&#x2026;end）</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #346604;">select</span> card_no 
<span style="color: #346604;">from</span> Customer_V_InTruckInfo 
<span style="color: #346604;">where</span> card_no <span style="color: #346604;">like</span> <span style="color: #5c3566;">'%dm16%'</span> 
<span style="color: #346604;">order</span> <span style="color: #346604;">by</span> (
  <span style="color: #346604;">case</span> 
     <span style="color: #346604;">when</span> 19%2=0 <span style="color: #346604;">then</span> <span style="color: #346604;">name</span> 
     <span style="color: #346604;">else</span> truck_no <span style="color: #346604;">end</span>
)
<span style="color: #5f615c; font-style: italic;">-- &#22914;&#26524;&#20351;&#29992;C#&#20195;&#30721;&#65292;19&#21487;&#26367;&#25442;&#20026;:"+DateTime.Now.Day+"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org66f0acf" class="outline-3">
<h3 id="org66f0acf"><span class="section-number-3">3.3</span> 分组获取记录的第一条数据</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #346604;">select</span> * <span style="color: #346604;">from</span>(
<span style="color: #346604;">SELECT</span>   ROW_NUMBER()over(partition <span style="color: #346604;">by</span> VehicleId <span style="color: #346604;">order</span> <span style="color: #346604;">by</span> CreateTime <span style="color: #346604;">DESC</span>) <span style="color: #346604;">as</span> RowNumber,ID, VehicleId, VehicleNo, Driver, DriverPhone, ContactType, 
                (<span style="color: #346604;">CASE</span> ContactType <span style="color: #346604;">WHEN</span> <span style="color: #5c3566;">'1'</span> <span style="color: #346604;">THEN</span> <span style="color: #5c3566;">'&#30701;&#20449;'</span> <span style="color: #346604;">WHEN</span> <span style="color: #5c3566;">'2'</span> <span style="color: #346604;">THEN</span> <span style="color: #5c3566;">'&#30005;&#35805;'</span> <span style="color: #346604;">END</span>) <span style="color: #346604;">AS</span> ContactType_ex, ContactContent, CreateUser, 
                CreateTime, ModifyUser, ModifyTime, ContactResult, 
                (<span style="color: #346604;">CASE</span> ContactResult <span style="color: #346604;">WHEN</span> <span style="color: #5c3566;">'1'</span> <span style="color: #346604;">THEN</span> <span style="color: #5c3566;">'&#26377;&#24847;&#21521;'</span> <span style="color: #346604;">WHEN</span> <span style="color: #5c3566;">'2'</span> <span style="color: #346604;">THEN</span> <span style="color: #5c3566;">'&#26080;&#24847;&#21521;'</span> <span style="color: #346604;">WHEN</span> <span style="color: #5c3566;">'3'</span> <span style="color: #346604;">THEN</span> <span style="color: #5c3566;">'&#20572;&#21345;'</span> <span style="color: #346604;">END</span>) 
                <span style="color: #346604;">AS</span> ContactResult_ex, NextContactTime, ContactPersonIdea, IsDelete, ExtendField1, ExtendField2, ExtendField3, 
                ExtendField4, ExtendField5
<span style="color: #346604;">FROM</span>      dbo.VehicleTrackInfo) <span style="color: #346604;">AS</span> track
<span style="color: #346604;">where</span> track.RowNumber=1
<span style="color: #346604;">and</span> track.VehicleId=<span style="color: #5c3566;">'95654e2ffb134f6581f94aa5ed178529'</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org90b38a2" class="outline-2">
<h2 id="org90b38a2"><span class="section-number-2">4</span> 其他操作</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org2506998" class="outline-3">
<h3 id="org2506998"><span class="section-number-3">4.1</span> 使用SQL语句清空数据库中所有表的数据</h3>
<div class="outline-text-3" id="text-4-1">
<pre class="example">
表非常多,一张一张的清空,实在麻烦,想利用SQL语句一次清空所有数据.找到了三种方法进行清空.使用的数据库为MS SQL SERVER.

</pre>
</div>
<div id="outline-container-org46585ed" class="outline-4">
<h4 id="org46585ed"><span class="section-number-4">4.1.1</span> Method 1:搜索出所有表名,构造为一条SQL语句</h4>
<div class="outline-text-4" id="text-4-1-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #346604;">declare</span> @trun_name <span style="color: #204a87;">varchar</span>(8000)
<span style="color: #346604;">set</span> @trun_name=<span style="color: #5c3566;">''</span>
<span style="color: #346604;">select</span> @trun_name=@trun_name + <span style="color: #5c3566;">'truncate table '</span> + [<span style="color: #346604;">name</span>] + <span style="color: #5c3566;">' '</span> <span style="color: #346604;">from</span> sysobjects <span style="color: #346604;">where</span> xtype=<span style="color: #5c3566;">'U'</span> <span style="color: #346604;">and</span> status &gt; 0
<span style="color: #346604;">exec</span> (@trun_name)
</pre>
</div>
<pre class="example">
该方法适合表不是非常多的情况,否则表数量过多,超过字符串的长度,不能进行完全清理.

</pre>
</div>
</div>
<div id="outline-container-org2ee4298" class="outline-4">
<h4 id="org2ee4298"><span class="section-number-4">4.1.2</span> Method 2:利用游标清理所有表</h4>
<div class="outline-text-4" id="text-4-1-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #346604;">declare</span> @trun_name <span style="color: #204a87;">varchar</span>(50)
<span style="color: #346604;">declare</span> name_cursor <span style="color: #346604;">cursor</span> <span style="color: #346604;">for</span>
<span style="color: #346604;">select</span> <span style="color: #5c3566;">'truncate table'</span> + <span style="color: #346604;">name</span> <span style="color: #346604;">from</span> sysobjects <span style="color: #346604;">where</span> xtype=<span style="color: #5c3566;">'U'</span> <span style="color: #346604;">and</span> status &gt; 0
<span style="color: #346604;">open</span> name_cursor
<span style="color: #346604;">fetch</span> <span style="color: #346604;">next</span> <span style="color: #346604;">from</span> name_cursor <span style="color: #346604;">into</span> @trun_name
while @@FETCH_STATUS = 0
<span style="color: #346604;">begin</span>
  <span style="color: #346604;">exec</span> (@trun_name)
  print <span style="color: #5c3566;">'truncated table'</span> + @trun_name
  <span style="color: #346604;">fetch</span> <span style="color: #346604;">next</span> <span style="color: #346604;">from</span> name_cursor <span style="color: #346604;">into</span> @trun_name
<span style="color: #346604;">end</span>
<span style="color: #346604;">close</span> name_cursor
<span style="color: #346604;">deallocate</span> name_cursor
</pre>
</div>
<pre class="example">
可以做为存储过程调用, 能够一次清空所有表的数据,并且还可以进行有选择的清空表.

</pre>
</div>
</div>
<div id="outline-container-orgaf5df96" class="outline-4">
<h4 id="orgaf5df96"><span class="section-number-4">4.1.3</span> Method 3:利用微软未公开的存储过程</h4>
<div class="outline-text-4" id="text-4-1-3">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #346604;">exec</span> sp_msforeachtable "truncate <span style="color: #346604;">table</span> ?"
</pre>
</div>
<pre class="example">
该方法可以一次清空所有表,但不能加过滤条件.
附-删除表：exec sp_msforeachtable 'DROP table ?'

</pre>
</div>
</div>
</div>
<div id="outline-container-org8313ca5" class="outline-3">
<h3 id="org8313ca5"><span class="section-number-3">4.2</span> SQL Server修改表名前的用户</h3>
<div class="outline-text-3" id="text-4-2">
<p>
1.只修改表前用户
</p>
<pre class="example">
EXEC sp_MSforeachtable 'exec sp_changeobjectowner "？","dbo" '
</pre>
<p>
2.用户表/存储过程/视图/触发器/自定义函数一起改
</p>
<pre class="example">
declare tb cursor local for
select 'sp_changeobjectowner ''['+replace(user_name(uid),']',']]')+'].['+replace(name,']',']]')+']'',''dbo'''
from sysobjects 
where xtype in('U','V','P','TR','FN','IF','TF') and status&gt;=0
open tb
declare @s nvarchar(4000)
fetch tb into @s
while @@fetch_status=0
begin
exec(@s)
fetch tb into @s
end
close tb
deallocate tb
</pre>
</div>
</div>
</div>
<div id="outline-container-org8dbf303" class="outline-2">
<h2 id="org8dbf303"><span class="section-number-2">5</span> 写在最后</h2>
<div class="outline-text-2" id="text-5">
<pre class="example">
以上内容，皆出自我的开发积累，如有任何问题请联系我。zrg1390556487@gmail.com

</pre>
</div>
</div>
