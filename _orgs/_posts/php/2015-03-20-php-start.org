#+TITLE:     PHP 入门
#+AUTHOR:    Rengui Zhao
#+EMAIL:     zrg1390556487@gmail.com
#+LANGUAGE:  cn
#+OPTIONS:   H:3 num:nil toc:nil \n:nil @:t ::t |:t ^:nil -:t f:t *:t <:t
#+OPTIONS:   TeX:t LaTeX:t skip:nil d:nil todo:t pri:nil tags:not-in-toc
#+INFOJS_OPT: view:plain toc:t ltoc:t mouse:underline buttons:0 path:http://cs3.swfc.edu.cn/~20121156044/.org-info.js />
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="http://cs3.swfu.edu.cn/~20121156044/.org-manual.css" />
#+HTML_HEAD: <style>body {font-size:14pt} code {font-weight:bold;font-size:100%; color:darkblue}</style>
#+EXPORT_SELECT_TAGS: export
#+EXPORT_EXCLUDE_TAGS: noexport
#+LINK_UP:   
#+LINK_HOME: 
#+XSLT: 

#+BEGIN_EXPORT HTML
---
layout: post
title: PHP 简单的登录与注册
author: zrg
comments: false
description: PHP 登录与注册实现
categories:
- php
tags:
- PHP
photos:
---
#+END_EXPORT

# (setq org-export-html-use-infojs nil)
# (setq org-export-html-style nil)
* PHP 简介
: 1.PHP(PHP Hypertext Preprocessor)，
: 2.PHP发展历程：
[[https://en.wikipedia.org/wiki/PHP][维基百科]]
* PHP 基础
: 
* PHP 代码片段
** PHP 生成UUID我唯一序列
#+NAME: PHP 生成UUID
#+BEGIN_SRC shell
function uuid($prefix ='')
{
	$chars = md5(uniqid(mt_rand(), true));
	$uuid = substr($chars,0,8) . '-';
	$uuid .= substr($chars,8,4) . '-';
	$uuid .= substr($chars,12,4) . '-';
	$uuid .= substr($chars,16,4) . '-';
	$uuid .= substr($chars,20,12);
	return $prefix . $uuid;
}
#+END_SRC
: 也可以使用SQL语句生成：insert into Price( Name, UUID, Price) values('FEIFEI_TEST', uuid(), 32);

** 判断二维数组是否为空
#+NAME: 判断二维数组是否为空
#+BEGIN_SRC shell
function array_is_null($arr = null){
	if(is_array($arr)){
		foreach($arr as $k=>$v){
			if($v&&!is_array($v)){
				return false;
			}
			$temp = $this->array_is_null($v);
			if(!$temp){
				return false;
			}
		}
		return true;
	}elseif(!$arr){
		return true;
	}else{
		return false;
	}
}
#+END_SRC
* 简单的登录示例
**** login.html
#+BEGIN_SRC sh emacs-lisp
<form name="loginform" method="post" action="login-fun.php" onsubmit="return InputCheck(this)">
  <input class="span12" type="text" name="username" id="username" placeholder="Username" />
   <input class="span12" type="password" name="password" id="password" placeholder="Password" />
   <a href="mailto:1390556487@qq.com?subject=Hello, administrator, I forgot my password." class="forgot">
   忘记密码,联系管理员</a>
     <div class="remember">
     <input id="remember-me" type="checkbox" />
     <label for="remember-me">记住密码</label>
   </div>
   <input class="btn-glow primary login" type="submit" name="submit" value="登录" onclick="check()" />
 </form>
#+END_SRC
**** login-fun.php
#+BEGIN_SRC sh emacs-lisp
<?php
/**
 * 登录
 */
if(!isset($_POST['submit'])){  
    exit('非法访问!');  
} 
include("conn/conn.php");   //引入数据库连接文件
$username = htmlspecialchars($_POST['username']);
$password = MD5($_POST['password']); 
$select=mysqli_query($conn,"SELECT Id from es_admin where AdminName='$username' and Password='$password'");
if($result = mysqli_fetch_array($select)){
    //登录成功  
    session_start();  
    $_SESSION['username'] = $username;  
    $_SESSION['password'] = $password;
    $_SESSION['Id']=$result['Id'];  
    echo "<script>window.location.href='index.php';</script>";
} else {  
// 登录失败
echo "<script>alert('登录失败!');window.location.href=\"signin.php\";</script>";
}  
?>
#+END_SRC
*** 应用在ThinkPHP 3.2.3中
**** login.html
#+BEGIN_SRC sh emacs-lisp
<form class="login-form" action="{:U('Home/Login/login','','')}" method="post">
   <span>
   请输入用户名和密码. </span>
   </div>
   <div class="form-group">
   <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
   <label class="control-label visible-ie8 visible-ie9">用户名</label>
   <div class="input-icon">
    <i class="fa fa-user"></i>
    <input class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="用户名" name="username"/>
    </div>
    </div>
    <div class="form-group">
    <label class="control-label visible-ie8 visible-ie9">密码</label>
    <div class="input-icon">
    <i class="fa fa-lock"></i>
    <input class="form-control placeholder-no-fix" type="password" autocomplete="off" placeholder="密码" name="password"/>
    </div>
    </div>
    <div class="form-group">
    <div class="input-icon" id="code">
    <input class="form-control placeholder-no-fix" type="code" utocomplete="off" placeholder="验证码" name="verify" /><img id="code" src="{:U('Home/Login/verify','','')}" />
    </div>
    </div>
    <div class="form-actions">
    <label class="checkbox">
    <input type="checkbox" name="remember" value="1"/> 记住密码 </label>
    <button type="submit" class="btn green-haze pull-right">
    登录 <i class="m-icon-swapright m-icon-white"></i>
    </button>
    </div>
    <div class="forget-password">
    <h4>忘记密码 ?</h4>
    <p>
    别担心，点击 <a href="javascript:;" id="forget-password">
    这儿 </a>
    </p>
    </div>
    </form>
#+END_SRC
**** LoginController.class.php
#+BEGIN_SRC sh emacs-lisp
//登陆验证
  public function login(){
   $username = I('username');
   $password = I('password','','md5');
   //login check
   $user=M('user')->where(array('username' => $username))->find();
   if (!$user || $user['password'] != $password) {
      $this->error('账号或密码错误');
   }
  
  //login information insert
  $data = array(
  'id' => $user['id'],
  'login_time' => date('Y-m-d H:i:s'),
  'login_ip' => get_client_ip(),
  );
  M('user')->save($data);

  //session
  session_start();
  $_SESSION['username']=$username;
  $_SESSION['password']=$password;
  $_SESSION['id']=$user['id'];
  $_SESSION['login_time']=time();

  $this->redirect('Home/Index/index');
  }
#+END_SRC
