---
layout: post
title: PHP 公共函数
author: zrg
comments: true
description: PHP 公共函数
categories:
- php
tags:
- PHP
photos:
---

<p>
如果你有任何问题或疑问，请发送Email至zrg1390556487@gmail.com！
</p>

<div id="outline-container-org89dce7e" class="outline-2">
<h2 id="org89dce7e">写在前面</h2>
<div class="outline-text-2" id="text-org89dce7e">
<pre class="example">
关于PHP的一些公共方法

</pre>
</div>
</div>
<div id="outline-container-org360d897" class="outline-2">
<h2 id="org360d897">字符串(String)/数组(Array)</h2>
<div class="outline-text-2" id="text-org360d897">
</div>
<div id="outline-container-orgd4f15e1" class="outline-3">
<h3 id="orgd4f15e1">字符串(String)</h3>
<div class="outline-text-3" id="text-orgd4f15e1">
</div>
<div id="outline-container-org8afeffe" class="outline-4">
<h4 id="org8afeffe">字符串长度</h4>
<div class="outline-text-4" id="text-org8afeffe">
<pre class="example">
$strLength=strlen($str);

</pre>
</div>
</div>
<div id="outline-container-org716a315" class="outline-4">
<h4 id="org716a315">大小写转换</h4>
<div class="outline-text-4" id="text-org716a315">
<pre class="example">
//小写转换为大写
strtoupper($str);
//大写转换为小写
strtolower($str);

</pre>
</div>
</div>
<div id="outline-container-org9eec003" class="outline-4">
<h4 id="org9eec003">字符串截取</h4>
<div class="outline-text-4" id="text-org9eec003">
<pre class="example">
//截取字符串，取出最有一个字符
substr($str,0,-1);

</pre>
</div>
</div>
</div>
<div id="outline-container-org650a16f" class="outline-3">
<h3 id="org650a16f">数组(Array)</h3>
<div class="outline-text-3" id="text-org650a16f">
</div>
<div id="outline-container-org60b915f" class="outline-4">
<h4 id="org60b915f">string⇌array</h4>
<div class="outline-text-4" id="text-org60b915f">
<pre class="example">
$array=explode(separator,$string);
$pizza = "piece1 piece2 piece3 piece4 piece5 piece6";
$pieces = explode(" ", $pizza);
echo $pieces[0]; // piece1
echo $pieces[1]; // piece2

</pre>

<pre class="example">
// 数组转化为字符串，implode()
$string=implode(glue,$array);

</pre>
</div>
</div>
<div id="outline-container-org9507733" class="outline-4">
<h4 id="org9507733">array 去除空元素</h4>
<div class="outline-text-4" id="text-org9507733">
<pre class="example">
//去除空元素
array_filter()

</pre>
</div>
</div>
<div id="outline-container-org310d781" class="outline-4">
<h4 id="org310d781">array 去除重复元素</h4>
<div class="outline-text-4" id="text-org310d781">
<pre class="example">
//去除重复元素
array_unique()

</pre>
</div>
</div>
<div id="outline-container-orgd0cfe22" class="outline-4">
<h4 id="orgd0cfe22">判断二维数组是否为空</h4>
<div class="outline-text-4" id="text-orgd0cfe22">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgf8f8254">function array_is_null($arr = null){ 
        if(is_array($arr)){ 
                foreach($arr as $k=&gt;$v){ 
                        if($v&amp;&amp;!is_array($v)){ 
                                return false<span style="color: #b22222;">; </span>
                        }
                        $t = self::array_is_null($v)<span style="color: #b22222;">; </span>
                        if(!$t){ 
                                return false<span style="color: #b22222;">; </span>
                        } 
                }
                return true<span style="color: #b22222;">; </span>
        }elseif(!$arr){ 
                return true<span style="color: #b22222;">; </span>
        }else{ 
                return false<span style="color: #b22222;">; </span>
        }
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org7fe1cd5" class="outline-2">
<h2 id="org7fe1cd5">日期(Date)/时间(Time)</h2>
<div class="outline-text-2" id="text-org7fe1cd5">
</div>
<div id="outline-container-org91d2235" class="outline-3">
<h3 id="org91d2235">获取当月天数及当月第一天及最后一天、上月第一天及最后一天</h3>
<div class="outline-text-3" id="text-org91d2235">
</div>
<div id="outline-container-org68f8262" class="outline-4">
<h4 id="org68f8262">获取上个月第一天及最后一天</h4>
<div class="outline-text-4" id="text-org68f8262">
<pre class="example">
echo date('Y-m-01', strtotime('-1 month'));
echo date('Y-m-t', strtotime('-1 month'));

</pre>

<pre class="example">
//上个月第一天:
echo date('Y-m-d', strtotime(date('Y-m-01') . ' -1 month')); // 计算出本月第一天再减一个月
//上个月最后一天:
echo date('Y-m-d', strtotime(date('Y-m-01') . ' -1 day')); // 计算出本月第一天再减一天

</pre>
</div>
</div>
<div id="outline-container-orgf258a9e" class="outline-4">
<h4 id="orgf258a9e">获取当月第一天及最后一天</h4>
<div class="outline-text-4" id="text-orgf258a9e">
<pre class="example">
$BeginDate=date('Y-m-01', strtotime(date("Y-m-d")));
echo date('Y-m-d', strtotime("$BeginDate +1 month -1 day"));

</pre>
</div>
</div>
<div id="outline-container-org0584cb4" class="outline-4">
<h4 id="org0584cb4">获取当前年份、月份、日、天数</h4>
<div class="outline-text-4" id="text-org0584cb4">
<pre class="example">
echo " 本月共有:".date("t")."天";
echo " 当前年份".date('Y');
echo " 当前月份".date('m');
echo " 当前几号".date('d');

</pre>
</div>
</div>
</div>
<div id="outline-container-orgc1d37b6" class="outline-3">
<h3 id="orgc1d37b6">日期转时间戳，时间戳转日期</h3>
<div class="outline-text-3" id="text-orgc1d37b6">
<pre class="example">
strtotime('2010-03-24 08:15:42');
date('Y-m-d H:i:s', 1156219870);

</pre>
</div>
</div>




<div id="outline-container-org2b89829" class="outline-3">
<h3 id="org2b89829">计算日期/时间差</h3>
<div class="outline-text-3" id="text-org2b89829">
</div>
<div id="outline-container-orge463a73" class="outline-4">
<h4 id="orge463a73">计算已成为会员多少天或距离某活动还剩余多少天?</h4>
<div class="outline-text-4" id="text-orge463a73">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgbb08672">function get_days_calc($calcTime, $currentTime, $differOrSurplus){
        switch ($differOrSurplus) {
        case 1:
                return round(($currentTime-$calcTime)/3600/24)<span style="color: #b22222;">;</span>
                break<span style="color: #b22222;">;</span>
        case 2:
                return round(($calcTime-$currentTime)/3600/24)<span style="color: #b22222;">;</span>
                break<span style="color: #b22222;">;</span>
        default:
                return round(($currentTime-$calcTime)/3600/24)<span style="color: #b22222;">;</span>
                break<span style="color: #b22222;">;</span>
        }
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgfd9d86f" class="outline-2">
<h2 id="orgfd9d86f">URL常用函数</h2>
<div class="outline-text-2" id="text-orgfd9d86f">
</div>
<div id="outline-container-orga841a66" class="outline-3">
<h3 id="orga841a66">获取当前URL</h3>
<div class="outline-text-3" id="text-orga841a66">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgd3ca089">function getCurrentPageURL()
{
        $pageURL = 'http'<span style="color: #b22222;">;</span>
        if (isset($_SERVER[<span style="color: #8b2252;">"HTTPS"</span>]) <span style="color: #228b22;">&amp;&amp;</span> $_SERVER[<span style="color: #8b2252;">"HTTPS"</span>] == <span style="color: #8b2252;">"on"</span>)
        {
                $pageURL .= <span style="color: #8b2252;">"s"</span><span style="color: #b22222;">;</span>
        }
        $pageURL .= <span style="color: #8b2252;">"://"</span><span style="color: #b22222;">;</span>
        if ($_SERVER[<span style="color: #8b2252;">"SERVER_PORT"</span>] != <span style="color: #8b2252;">"80"</span>)
        {
                $pageURL .= $_SERVER[<span style="color: #8b2252;">"SERVER_NAME"</span>] . <span style="color: #8b2252;">":"</span> . $_SERVER[<span style="color: #8b2252;">"SERVER_PORT"</span>] . $_SERVER[<span style="color: #8b2252;">"REQUEST_URI"</span>]<span style="color: #b22222;">;</span>
        }
        else
        {
                $pageURL .= $_SERVER[<span style="color: #8b2252;">"SERVER_NAME"</span>] . $_SERVER[<span style="color: #8b2252;">"REQUEST_URI"</span>]<span style="color: #b22222;">;</span>
        }
        return $pageURL<span style="color: #b22222;">;</span>
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgda2de88" class="outline-3">
<h3 id="orgda2de88">请求处理</h3>
<div class="outline-text-3" id="text-orgda2de88">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgd9757e3">function curl( $url = '',$method = 'GET',$req_data = false,$header = false,$response_header = false,$exec_time = 5,$connect_time = 5 )
{
        $method = strtoupper( $method )<span style="color: #b22222;">;</span>
        $ch = curl_init()<span style="color: #b22222;">;</span>
        // &#35774;&#32622;&#35831;&#27714;url
        curl_setopt( $ch,CURLOPT_URL,$url )<span style="color: #b22222;">;</span>
        // &#35774;&#32622;&#35831;&#27714;&#26041;&#27861;,&#40664;&#35748;&#25191;&#34892;GET&#35831;&#27714;&#65292;&#26080;&#38656;&#35774;&#32622;
        if( 'POST' == $method ){
                curl_setopt( $ch, CURLOPT_POST,1 )<span style="color: #b22222;">;</span>
        }elseif( 'GET' != $method ){
                curl_setopt( $ch, CURLOPT_CUSTOMREQUEST,$method )<span style="color: #b22222;">;</span>
        }
        // &#35774;&#32622;&#35831;&#27714;&#22836;
        if( null != $header <span style="color: #228b22;">&amp;&amp;</span> is_array($header) ){
                curl_setopt( $ch,CURLOPT_HTTPHEADER,array_map(<span style="color: #a020f0;">function</span>($field,$value){
                        return $field . ':' . $value<span style="color: #b22222;">;</span>
                }, array_keys($header), $header) )<span style="color: #b22222;">;</span>
        }
        // &#35774;&#32622;&#35831;&#35831;&#27714;&#25968;&#25454;
        if( null != $req_data <span style="color: #228b22;">&amp;&amp;</span> 'GET' != $method ){
                if ( is_array($req_data) <span style="color: #228b22;">&amp;&amp;</span> !isset($req_data['isfile']) ){
                        $req_data = http_build_query($req_data)<span style="color: #b22222;">;</span>
                }
                curl_setopt( $ch,CURLOPT_POSTFIELDS,$req_data )<span style="color: #b22222;">;</span>
        }
        //&#35774;&#32622;&#36755;&#20986;&#25968;&#25454;&#20013;&#21253;&#21547;http header
        curl_setopt( $ch, CURLOPT_HEADER,$response_header )<span style="color: #b22222;">;</span>
        // &#23558;curl_exec()&#33719;&#21462;&#30340;&#20449;&#24687;&#20197;&#23383;&#31526;&#20018;&#36820;&#22238;&#65292;&#32780;&#19981;&#26159;&#30452;&#25509;&#36755;&#20986;
        curl_setopt( $ch,CURLOPT_RETURNTRANSFER,true )<span style="color: #b22222;">;</span>
        // &#20801;&#35768; cURL &#20989;&#25968;&#25191;&#34892;&#30340;&#26368;&#38271;&#31186;&#25968;&#12290;
        curl_setopt( $ch,CURLOPT_TIMEOUT,$exec_time )<span style="color: #b22222;">;</span>
        //&#22312;&#23581;&#35797;&#36830;&#25509;&#26102;&#31561;&#24453;&#30340;&#31186;&#25968;&#12290;&#35774;&#32622;&#20026;0&#65292;&#21017;&#26080;&#38480;&#31561;&#24453;
        curl_setopt( $ch,CURLOPT_CONNECTTIMEOUT,$connect_time )<span style="color: #b22222;">;</span>
        // &#25191;&#34892;curl&#35831;&#27714;
        $response = curl_exec($ch)<span style="color: #b22222;">;</span>
        //&#33719;&#21462;&#29366;&#24577;&#30721;
        $status = curl_getinfo($ch, CURLINFO_HTTP_CODE)<span style="color: #b22222;">;</span>
        //&#20851;&#38381;curl&#22238;&#35805;&#24182;&#37322;&#25918;&#36164;&#28304;
        curl_close($ch)<span style="color: #b22222;">;</span>
        //&#20998;&#31163;header&#19982;body
        if( $response_header ){
                $tmp         = explode(<span style="color: #8b2252;">"\r\n\r\n"</span>, $response)<span style="color: #b22222;">;</span>
                $resp_header = $tmp[0]<span style="color: #b22222;">;</span>
                $data        = $tmp[1]<span style="color: #b22222;">;</span>
        } else {
                $resp_header = null<span style="color: #b22222;">;</span>
                $data        = $response<span style="color: #b22222;">;</span>
        }
        $result['errcode'] = $status<span style="color: #b22222;">;</span>
        $result['header']  = $resp_header<span style="color: #b22222;">;</span>
        $result['data']    = $data<span style="color: #b22222;">;</span>
        return $result<span style="color: #b22222;">;</span>
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0ec2562" class="outline-2">
<h2 id="org0ec2562">文件(File)</h2>
<div class="outline-text-2" id="text-org0ec2562">
</div>
<div id="outline-container-org1d6256c" class="outline-3">
<h3 id="org1d6256c">下载文件</h3>
<div class="outline-text-3" id="text-org1d6256c">
<div class="org-src-container">
<pre class="src src-shell" id="org262b387"><span class="linenr"> 1: </span><span style="color: #0000ff;">header</span>(<span style="color: #8b2252;">"Content-type:text/html;charset=utf-8"</span>);
<span class="linenr"> 2: </span>/**
<span class="linenr"> 3: </span>* &#25991;&#20214;&#19979;&#36733;
<span class="linenr"> 4: </span>* @param  [type] $<span style="color: #a0522d;">file_url</span> [&#32477;&#23545;&#36335;&#24452;&#65292;&#22914;:$<span style="color: #a0522d;">_SERVER</span>[<span style="color: #8b2252;">'DOCUMENT_ROOT'</span>].<span style="color: #8b2252;">'/upload/file/2019/01/18/test.png'</span>;]
<span class="linenr"> 5: </span>* @param  [type] $<span style="color: #a0522d;">new_name</span> [&#25351;&#23450;&#25991;&#20214;&#21517;&#31216;]
<span class="linenr"> 6: </span>* @return [type] [description]
<span class="linenr"> 7: </span>*/
<span class="linenr"> 8: </span><span style="color: #a020f0;">function</span> <span style="color: #0000ff;">downloadFile</span>($<span style="color: #a0522d;">file_url</span>,$<span style="color: #a0522d;">new_name</span>=<span style="color: #8b2252;">''</span>){
<span class="linenr"> 9: </span>     <span style="color: #a020f0;">if</span>(!isset($<span style="color: #a0522d;">file_url</span>)||trim($<span style="color: #a0522d;">file_url</span>) == <span style="color: #8b2252;">''</span>){
<span class="linenr">10: </span>             <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'500'</span>;
<span class="linenr">11: </span>     }
<span class="linenr">12: </span>     //&#26816;&#26597;&#25991;&#20214;&#26159;&#21542;&#23384;&#22312;
<span class="linenr">13: </span>     <span style="color: #a020f0;">if</span>(!file_exists($<span style="color: #a0522d;">file_url</span>)){
<span class="linenr">14: </span>             <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'404'</span>;
<span class="linenr">15: </span>     }
<span class="linenr">16: </span>     $<span style="color: #a0522d;">file_name</span>=basename($<span style="color: #a0522d;">file_url</span>);
<span class="linenr">17: </span>     $<span style="color: #a0522d;">file_type</span>=explode(<span style="color: #8b2252;">'.'</span>,$<span style="color: #a0522d;">file_url</span>);
<span class="linenr">18: </span>     $<span style="color: #a0522d;">file_type</span>=$<span style="color: #a0522d;">file_type</span>[count($<span style="color: #a0522d;">file_type</span>)-1];
<span class="linenr">19: </span>     $<span style="color: #a0522d;">file_name</span>=trim($<span style="color: #a0522d;">new_name</span>==<span style="color: #8b2252;">''</span>)?$<span style="color: #a0522d;">file_name</span>:urlencode($<span style="color: #a0522d;">new_name</span>);
<span class="linenr">20: </span>     $<span style="color: #a0522d;">file_type</span>=fopen($<span style="color: #a0522d;">file_url</span>,<span style="color: #8b2252;">'r'</span>); //&#25171;&#24320;&#25991;&#20214;
<span class="linenr">21: </span>     //&#36755;&#20837;&#25991;&#20214;&#26631;&#31614;
<span class="linenr">22: </span>     header(<span style="color: #8b2252;">"Content-type: application/octet-stream"</span>);  
<span class="linenr">23: </span>     header(<span style="color: #8b2252;">"Accept-Ranges: bytes"</span>);  
<span class="linenr">24: </span>     header(<span style="color: #8b2252;">"Accept-Length: "</span>.filesize($<span style="color: #a0522d;">file_url</span>));  
<span class="linenr">25: </span>     header(<span style="color: #8b2252;">"Content-Disposition: attachment; filename="</span>.$<span style="color: #a0522d;">file_name</span>);  
<span class="linenr">26: </span>     //&#36755;&#20986;&#25991;&#20214;&#20869;&#23481;  
<span class="linenr">27: </span>     <span style="color: #483d8b;">echo</span> fread($<span style="color: #a0522d;">file_type</span>,filesize($<span style="color: #a0522d;">file_url</span>));
<span class="linenr">28: </span>     fclose($<span style="color: #a0522d;">file_type</span>);
<span class="linenr">29: </span>}
</pre>
</div>
<pre class="example">
几点注意事项：

</pre>
<ol class="org-ol">
<li>header("Content-type:text/html;charset=utf-8")的作用：在服务器响应浏览器的请求时，告诉浏览器以编码格式为UTF-8的编码显示该内容。</li>
<li>关于file_exists()函数不支持中文路径的问题:因为php函数比较早，不支持中文，所以如果被下载的文件名是中文的话，需要对其进行字符编码转换，否则file_exists()函数不能识别，可以使用iconv()函数进行编码转换。</li>
<li>$file_sub_path() 我使用的是绝对路径，执行效率要比相对路径高。</li>
<li>Header("Content-type: application/octet-stream")的作用：通过这句代码客户端浏览器就能知道服务端返回的文件形式。</li>
<li>Header("Accept-Ranges: bytes")的作用：告诉客户端浏览器返回的文件大小是按照字节进行计算的。</li>
<li>Header("Accept-Length:".$file_size)的作用：告诉浏览器返回的文件大小。</li>
<li>Header("Content-Disposition: attachment; filename=".$file_name)的作用:告诉浏览器返回的文件的名称。</li>
<li>以上四个Header()是必需的。</li>
<li>fclose($fp)可以把缓冲区内最后剩余的数据输出到磁盘文件中，并释放文件指针和有关的缓冲区</li>
</ol>
</div>
</div>
<div id="outline-container-org51762f9" class="outline-3">
<h3 id="org51762f9">参考资料</h3>
<div class="outline-text-3" id="text-org51762f9">
<ul class="org-ul">
<li><a href="http://www.cnblogs.com/hongfei/archive/2012/06/12/2546929.html">Php如何实现下载功能超详细流程分析</a></li>
<li><a href="https://blog.csdn.net/hj960511/article/details/51837990">php实现当前页面点击下载文件实例</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgbf37b71" class="outline-2">
<h2 id="orgbf37b71">其他代码片段</h2>
<div class="outline-text-2" id="text-orgbf37b71">
</div>
<div id="outline-container-orga11daad" class="outline-3">
<h3 id="orga11daad">PHP 生成UUID我唯一序列</h3>
<div class="outline-text-3" id="text-orga11daad">
<div class="org-src-container">
<pre class="src src-shell" id="orgea4da7e"><span class="linenr"> 1: </span><span style="color: #a020f0;">function</span> <span style="color: #0000ff;">uuid</span>($<span style="color: #a0522d;">prefix</span> =<span style="color: #8b2252;">''</span>)                                                                                                                            
<span class="linenr"> 2: </span>{                                                                                                                                                     
<span class="linenr"> 3: </span>        $<span style="color: #a0522d;">chars</span> = md5(uniqid(mt_rand(), true));                                                                                                        
<span class="linenr"> 4: </span>        $<span style="color: #a0522d;">uuid</span> = substr($<span style="color: #a0522d;">chars</span>,0,8) <span style="color: #483d8b;">.</span> <span style="color: #8b2252;">'-'</span>;                                                                                                             
<span class="linenr"> 5: </span>        $<span style="color: #a0522d;">uuid</span> .= substr($<span style="color: #a0522d;">chars</span>,8,4) <span style="color: #483d8b;">.</span> <span style="color: #8b2252;">'-'</span>;                                                                                                            
<span class="linenr"> 6: </span>        $<span style="color: #a0522d;">uuid</span> .= substr($<span style="color: #a0522d;">chars</span>,12,4) <span style="color: #483d8b;">.</span> <span style="color: #8b2252;">'-'</span>;                                                                                                           
<span class="linenr"> 7: </span>        $<span style="color: #a0522d;">uuid</span> .= substr($<span style="color: #a0522d;">chars</span>,16,4) <span style="color: #483d8b;">.</span> <span style="color: #8b2252;">'-'</span>;                                                                                                           
<span class="linenr"> 8: </span>        $<span style="color: #a0522d;">uuid</span> .= substr($<span style="color: #a0522d;">chars</span>,20,12);                                                                                                                
<span class="linenr"> 9: </span>        <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">prefix</span> . $<span style="color: #a0522d;">uuid</span>;                                                                                                                       
<span class="linenr">10: </span>}                                                                                                                                                     
</pre>
</div>
<pre class="example">
也可以使用SQL语句生成：insert into Price( Name, UUID, Price) values('FEIFEI_TEST', uuid(), 32); 

</pre>
</div>
</div>
</div>
