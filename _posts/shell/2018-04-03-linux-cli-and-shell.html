---
layout: post
title: 《Linux 命令行与 Shell 编程大全》阅读笔记
author: zrg
comments: false
description: 命令行界面（command line interface，CLI），Linux，Shell
categories:
- Linux
- Shell
tags:
- Shell
photos:
---

<div id="outline-container-orgdc986a3" class="outline-2">
<h2 id="orgdc986a3">Linux 命令行</h2>
<div class="outline-text-2" id="text-orgdc986a3">
</div>
<div id="outline-container-orgb9486f6" class="outline-3">
<h3 id="orgb9486f6">初探 bash shell 命令</h3>
<div class="outline-text-3" id="text-orgb9486f6">
</div>
<div id="outline-container-org2034d3c" class="outline-4">
<h4 id="org2034d3c">学习 shell 开始</h4>
<div class="outline-text-4" id="text-org2034d3c">
<ol class="org-ol">
<li>启动 shell
<ul class="org-ul">
<li>/bin/bash //重点讨论 GNU bash shell</li>
</ul></li>
<li>shell 提示符
<ul class="org-ul">
<li>默认的 bash shell 提示符是美元符号 \(，看起来是这样的：zrg@debian:~\)</li>
</ul></li>
<li>bash 手册
<ul class="org-ul">
<li>man 命令用来访问存储在 Linux 系统上的手册页面。</li>
</ul></li>
</ol>
<p>
$ man man
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">节</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Name</td>
<td class="org-left">显示命令和一段简短的描述</td>
</tr>

<tr>
<td class="org-left">Synopsis</td>
<td class="org-left">命令的语法</td>
</tr>

<tr>
<td class="org-left">Configuration</td>
<td class="org-left">命令配置信息</td>
</tr>

<tr>
<td class="org-left">Description</td>
<td class="org-left">命令的一般性描述</td>
</tr>

<tr>
<td class="org-left">Options</td>
<td class="org-left">命令选项描述</td>
</tr>

<tr>
<td class="org-left">Exit Status</td>
<td class="org-left">命令的推出状态指示</td>
</tr>

<tr>
<td class="org-left">Return Value</td>
<td class="org-left">命令的返回值</td>
</tr>

<tr>
<td class="org-left">Errors</td>
<td class="org-left">命令的错误信息</td>
</tr>

<tr>
<td class="org-left">Environment</td>
<td class="org-left">描述所使用的环境变量</td>
</tr>

<tr>
<td class="org-left">Files</td>
<td class="org-left">命令用到的文件</td>
</tr>

<tr>
<td class="org-left">Versions</td>
<td class="org-left">命令的版本信息</td>
</tr>

<tr>
<td class="org-left">Conforming To</td>
<td class="org-left">命令所遵从的标准</td>
</tr>

<tr>
<td class="org-left">Notes</td>
<td class="org-left">其他有帮助的资料</td>
</tr>

<tr>
<td class="org-left">Bugs</td>
<td class="org-left">提供提交Bug的途径</td>
</tr>

<tr>
<td class="org-left">Example</td>
<td class="org-left">展示命令的用法</td>
</tr>

<tr>
<td class="org-left">Authors</td>
<td class="org-left">命令开发人员的信息</td>
</tr>

<tr>
<td class="org-left">Copyright</td>
<td class="org-left">命令源代码的版权状况</td>
</tr>

<tr>
<td class="org-left">See Also</td>
<td class="org-left">与该命令类似的其他命令</td>
</tr>
</tbody>
</table>
<pre class="example">
如果不记得命令名怎么办？可以使用关键字搜索手册页。
$ man -k terminal

</pre>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> Linux 手册页的内容区域</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">区域号</th>
<th scope="col" class="org-left">所涵盖的内容</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">可执行程序或shell命令</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">系统调用</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">库调用</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">特殊文件</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">文件格式与约定</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">游戏</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">概览、约定及杂项</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">超级用户和系统管理员命令</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-left">内核例程</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgfd2e8e6" class="outline-4">
<h4 id="orgfd2e8e6">文件、目录操作</h4>
<div class="outline-text-4" id="text-orgfd2e8e6">
<ul class="org-ul">
<li>cd</li>
<li>ls</li>
<li>touch</li>
<li>cp</li>
<li>mv</li>
<li>ln</li>
<li>rm</li>
<li>mkdir</li>
<li>rmdir</li>
<li>file</li>
<li>cat</li>
<li>more</li>
<li>less</li>
<li>tail</li>
<li>head</li>
</ul>
</div>
</div>
<div id="outline-container-org16548b2" class="outline-4">
<h4 id="org16548b2">进程、磁盘统计和管理</h4>
<div class="outline-text-4" id="text-org16548b2">
<ul class="org-ul">
<li>ps -ef</li>
<li>top</li>
<li>kill</li>
<li>killall</li>
<li>mount</li>
<li>umount</li>
<li>df -h</li>
<li>du</li>
</ul>
</div>
</div>
<div id="outline-container-orgacef9d2" class="outline-4">
<h4 id="orgacef9d2">排序、归档数据</h4>
<div class="outline-text-4" id="text-orgacef9d2">
<ul class="org-ul">
<li>sort</li>
<li>grep</li>
<li>gzip</li>
<li>gzcat</li>
<li>gunzip</li>
<li>tar</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orga6d6164" class="outline-3">
<h3 id="orga6d6164">理解 shell</h3>
<div class="outline-text-3" id="text-orga6d6164">
</div>
<div id="outline-container-org50c965f" class="outline-4">
<h4 id="org50c965f">shell 类型</h4>
<div class="outline-text-4" id="text-org50c965f">
<ul class="org-ul">
<li>/bin/bash</li>
<li>/bin/tcsh</li>
<li>/bin/dash</li>
<li>/bin/csh</li>
<li>/bin/sh</li>
</ul>
</div>
</div>
<div id="outline-container-org12873d1" class="outline-4">
<h4 id="org12873d1">Shell 的父子关系</h4>
<div class="outline-text-4" id="text-org12873d1">
</div>
<ul class="org-ul">
<li><a id="org5a8a655"></a>理解<br />
<div class="outline-text-5" id="text-org5a8a655">
<pre class="example">
$ ps -f

</pre>
<p>
UID        PID  PPID  C STIME TTY          TIME CMD
zrg      25305  4834  8 23:51 pts/4    00:00:00 -bash
zrg      25317 25305  0 23:51 pts/4    00:00:00 ps -f
</p>
<pre class="example">
$ bash
$ ps -f

</pre>
<p>
 UID        PID  PPID  C STIME TTY          TIME CMD
 zrg      25305  4834  0 23:51 pts/4    00:00:00 -bash
 zrg      25347 25305  0 23:53 pts/4    00:00:00 bash
 zrg      25352 25347  0 23:54 pts/4    00:00:00 ps -f
输入命令之后，一个子 shell 就出现了。第二个 ps -f 是在子 shell 中执行的。可以从显示结果中看到两个 bash shell 程序在运行。
</p>
<pre class="example">
$ bash
$ bash
$ bash
$ ps --forest

</pre>
<p>
   PID TTY          TIME CMD
 25305 pts/4    00:00:00 bash
 25347 pts/4    00:00:00  &ensp;bash
 25372 pts/4    00:00:00      &ensp;bash
 25377 pts/4    00:00:00          &ensp;bash
 25382 pts/4    00:00:00              &ensp;ps
在上面例子中，bash 命令被输入了三次。实际上创建了三个子 shell。ps &#x2013;forest 命令展示了这些子 shell 间的嵌套结构。
可以使用 exit 命令退出子 shell
</p>
<pre class="example">
$ exit

</pre>
</div>
</li>
<li><a id="orgb87b76a"></a>进程列表<br />
<div class="outline-text-5" id="text-orgb87b76a">
<pre class="example">
$ pwd;ls;cd /etc;pwd

</pre>
<p>
/home/zrg/zhaorengui.github.io
404.html  archives  categories  _config.yml  _drafts  Gemfile.lock  index.html  _orgs   README.en.md  _sass       _site  tags
about     assets    category    _data        Gemfile  _includes     _layouts    _posts  README.md     search.xml  tag
/etc
在命令之间加入“;，指定要依次执行的一系列命令
</p>

<pre class="example">
$ (pwd;ls;cd /etc;pwd)

</pre>
<p>
/home/zrg/zhaorengui.github.io
404.html  archives  categories  _config.yml  _drafts  Gemfile.lock  index.html  _orgs   README.en.md  _sass       _site  tags
about     assets    category    _data        Gemfile  _includes     _layouts    _posts  README.md     search.xml  tag
/etc
使用括号包含命令，成为进程列表
</p>

<p>
查看是否生成了子 shell，使用：
</p>
<pre class="example">
$ echo $BASH_SUBSHELL

</pre>
</div>
</li>
<li><a id="org8204714"></a>子shell用法<br />
<div class="outline-text-5" id="text-org8204714">
<pre class="example">
// 在后台睡眠10s
$ sleep 10&amp;
// 查看后台进程
$ ps -f
or
$ jobs -l

</pre>

<pre class="example">
//将进程列表置入后台
$ (sleep 2;echo $BASH_SUBSHELL;sleep 2)&amp;
// 创建备份
$ (tar -cf Rich.rar /home/rich;tar -cf My.tar /home/christine)&amp;

</pre>

<pre class="example">
//协程：在后台生成一个子shell，同时在这个子shell中执行命令。
// 进行协程处理，使用 coproc 命令
$ coproc sleep 10
$ coproc My_Job{sleep 10;}

</pre>
</div>
</li>
</ul>
</div>
<div id="outline-container-org389e6eb" class="outline-4">
<h4 id="org389e6eb">理解 shell 的内建命令</h4>
<div class="outline-text-4" id="text-org389e6eb">
<ul class="org-ul">
<li>外部命令</li>
</ul>
<pre class="example">
也被称为文件系统命令，是存在于bash shell之外的程序。
ps 就是一个外部命令，可以使用 which 和 type 命令找到
$ which ps
$ type -a ps
当外部命令执行时，会创建一个子进程，这种操作叫做衍生（forking）。

</pre>

<ul class="org-ul">
<li>内建命令</li>
</ul>
<pre class="example">
内建命令和外部命令的区别在于前者不需要使用子进程来执行。它们已经和 shell 编译成一体，作为 shell 工具的组成部分存在。
可以利用 type 命令来了解某个命令是否是内建的。
$ type cd
cd is a shell builtin
要注意，有些命令有多种实现。既有内建命令也有外部命令。
$ type -a echo
echo is a shell builtin
echo is /bin/echo
$ type -a pwd
pwd is a shell builtin
pwd is /bin/pwd

</pre>
</div>
</div>
</div>
<div id="outline-container-org51f3c87" class="outline-3">
<h3 id="org51f3c87">使用 Linux 环境变量</h3>
<div class="outline-text-3" id="text-org51f3c87">
<pre class="example">
1. 环境变量（environment variable），用来存储有关 shell 会话和工作环境的信息。

</pre>

<pre class="example">
2. 全局环境变量和局部环境变量::
// 查看全局变量
$ env
or
$ printenv
// 查看某个全局环境变量
$ env HOME
or
$ echo $HOME
// set 命令会显示为某个特定进程设置的所有环境变量，包括全局变量、局部变量以及用户自定义变量。
$ set

</pre>

<pre class="example">
3. 设置用户自定义变量
$ my_variable=Hello
注意：所有环境变量名均使用大写字母，这是 bash shell 的标准惯例。自己创建的局部变量或是 shell 脚本，请使用小写字母。变量名区分大小写。
$ my_variable="Hello World"
// 设置全局变量
$ export my_variable="I am Global now"
// 删除环境变量
$ unset my_variable
注意：如果要用到变量，使用$；如果要操作变量，不使用$。

</pre>

<pre class="example">
4. 默认的 shell 环境变量

</pre>

<pre class="example">
5. 设置 PATH 环境变量
$ PATH=$PATH:/opt/test/scripts

</pre>

<pre class="example">
6. 定位系统环境变量

</pre>
<ul class="org-ul">
<li>登录时作为默认登录 shell</li>
</ul>
<pre class="example">
登录 shell 会从5个不同的启动文件里读取命令：
/etc/profile，默认的 bash shell 主启动文件。
$HOME/.bash_profile
$HOME/.bashrc
$HOME/.bash_login
$HOME/.profile

</pre>
<ul class="org-ul">
<li>作为非登录 shell 的交互式 shell</li>
</ul>
<pre class="example">
作为非登录 shell 的交互式启动的，它不会访问 /etc/profile 文件，只会检查 HOME 目录中的 .bashrc 文件。
.bashrc 文件有两个作用：一是查看/etc目录下通用的 bashrc 文件；二是为用户提供一个定制自己的命名别名和私有脚本函数的地方。

</pre>
<ul class="org-ul">
<li>作为运行脚本的非交互式shell</li>
</ul>
<pre class="example">
系统执行 shell 脚本时使用，不同的地方在于它没有命令提示符。bash shell 提供了 BASH_ENV 环境变量，当 shell 启动一个非交互式 shell 进程时，它会检查这个环境变量来查看要执行的启动文件。
// 环境变量持久化
在大多数发行版中，存储个人用户永久性 bash shell 变量的地方是 $HOME/.bashrc 文件。但如果设置了 BASH_ENV 变量，那么记住，除非它指向的是 $HOME/.bashrc，否则应该将非交互式 shell 的用户变量放在别的地方。

</pre>

<pre class="example">
7. 数组变量
//环境变量作为数组使用
$ mytest=(one two three four five)
$ echo ${mytest[2]}
three
$ echo ${mytest[*]}
one two three four five
//改变某个索引的值
$ mytest[2] = seven
//删除某个索引的值和删除整个数组
$ unset mytest[2]
$ unset mytest

</pre>
</div>
</div>
<div id="outline-container-orgd1712aa" class="outline-3">
<h3 id="orgd1712aa">理解 Linux 文件权限</h3>
<div class="outline-text-3" id="text-orgd1712aa">
</div>
<div id="outline-container-org7225ada" class="outline-4">
<h4 id="org7225ada">Linux 的安全性</h4>
<div class="outline-text-4" id="text-org7225ada">
<pre class="example">
1. /etc/passwd 文件
$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
...
zrg:x:1000:1000:zrg,,,:/home/zrg:/bin/bash
/etc/passwd 文件的字段包含如下信息：

</pre>
<ul class="org-ul">
<li>登录用户名</li>
<li>用户密码</li>
<li>UID</li>
<li>Group ID</li>
<li>描述</li>
<li>HOME目录位置</li>
<li>默认shell</li>
</ul>
<pre class="example">
/etc/passwd文件中的密码字段都被设置成了x，多数Linux系统都将用户密码保存在/etc/shadow文件中，只有特定的程序（比如登录程序）才能访问这个文件。
一般情况下，不建议直接手动在/etc/passwd文件里进行用户管理（比如添加、修改或删除用户账户）。用标准的Linux用户管理工具去执行这些操作就会安全许多。

</pre>

<pre class="example">
2. /etc/shadow 文件
/etc/shadow文件的每条记录都有9个字段：

</pre>
<ul class="org-ul">
<li>与/etc/passwd文件对应的登录名</li>
<li>加密后的密码</li>
<li>自上次修改密码后过去的天数密码（自1970年1月1日开始计算）</li>
<li>多少天后才能更改密码</li>
<li>多少天后必须更改密码</li>
<li>密码过期前提前多少天提醒用户更改密码</li>
<li>密码过期后多少天禁用用户帐目</li>
<li>用户账户被禁用的日期（用自1970年1月1日到当天的天数表示）</li>
<li>预留字段给将来使用</li>
</ul>

<pre class="example">
3. 新增、删除和修改用户
新增用户
$ /usr/sbin/useradd -D

</pre>
<ul class="org-ul">
<li>GROUP=100 //新用户被添加到GID为100的公共组</li>
<li>HOME=/home //HOME目录位置</li>
<li>INACTIVE=-1 //密码过期后不会被禁用</li>
<li>EXPIRE= //未被设置过期日期</li>
<li>SHELL=/bin/sh //将sh作为默认shell</li>
<li>SKEL=/etc/skel //会将/etc/skel目录下的内容复制到用户的HOME目录下</li>
<li>CREATE_MAIL_SPOOL=no //是否为该用户账户在mail目录下创建一个用于接收邮件的文件</li>
</ul>
<pre class="example">
//用默认系统参数创建一个新用户账户
$ useradd test
//要想在创建用户时改变默认值或默认行为，可以使用命令参数。
$ man useradd
//删除用户
默认情况下，userdel命令只会删除/etc/passwd文件中的用户信息，而不会删除系统中属于该账户的任何文件。
$ userdel -r test
加上-r参数，userdel会删除用户的HOME目录以及邮件目录，但必须在删除之前检查清楚（比如是否存放了其他用户或其他程序要使用的重要文件）
//修改用户

</pre>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 2:</span> 用户账户修改工具</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">命令</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">usermod</td>
<td class="org-left">修改用户账户的字段，指定主要组以及附加组的所属关系</td>
</tr>

<tr>
<td class="org-left">passwd</td>
<td class="org-left">修改已有用户的密码</td>
</tr>

<tr>
<td class="org-left">chpasswd</td>
<td class="org-left">从文件中读取登录名密码对，并更新密码</td>
</tr>

<tr>
<td class="org-left">chage</td>
<td class="org-left">修改密码的过期时间</td>
</tr>

<tr>
<td class="org-left">chfn</td>
<td class="org-left">修改用户账户的备注信息</td>
</tr>

<tr>
<td class="org-left">chsh</td>
<td class="org-left">修改用户账户的默认登录shell</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org95faca5" class="outline-4">
<h4 id="org95faca5">使用 Linux 组</h4>
<div class="outline-text-4" id="text-org95faca5">
<pre class="example">
1. /etc/group 文件
/etc/group文件有4个字段：

</pre>
<ul class="org-ul">
<li>组名</li>
<li>组密码</li>
<li>GID</li>
<li>属于该组的用户列表，当一个用户在/etc/passwd文件中指定某个组作为默认组时，用户账户不会作为该组成员再出现在/etc/group文件中。</li>
</ul>
<pre class="example">
2. 创建、修改组
$ /usr/sbin/groupadd shared
$ /usr/sbin/groupmod -n sharing shared

</pre>
</div>
</div>
<div id="outline-container-org88ce30e" class="outline-4">
<h4 id="org88ce30e">理解文件权限</h4>
<div class="outline-text-4" id="text-org88ce30e">
<pre class="example">
1. 使用文件权限符

</pre>
<ul class="org-ul">
<li>-文件</li>
<li>d目录</li>
<li>l链接</li>
<li>c字符型设备</li>
<li>b块设备</li>
<li>n网络设备</li>
<li>r可读</li>
<li>w可写</li>
<li>x可执行</li>
<li>对象所属用户</li>
<li>对象所属组</li>
<li>系统其他用户</li>
</ul>

<pre class="example">
2. 默认文件权限
umask命令用来设置所创建文件和目录的默认权限。

</pre>
</div>
</div>
<div id="outline-container-orgc5ee423" class="outline-4">
<h4 id="orgc5ee423">改变安全性设置</h4>
<div class="outline-text-4" id="text-orgc5ee423">
<pre class="example">
1. 改变权限
chmod命令用来改变文件和目录的安全性设置。

</pre>

<pre class="example">
2. 改变所属关系
chown命令用来改变文件的所属组。

</pre>
</div>
</div>
<div id="outline-container-org8d91280" class="outline-4">
<h4 id="org8d91280">共享文件</h4>
<div class="outline-text-4" id="text-org8d91280">
<pre class="example">
Linux为每个文件和目录存储了3个额外的信息位。

</pre>
<ul class="org-ul">
<li>设置用户ID（SUID）</li>
<li>设置组ID（GID）</li>
<li>粘着位：进程结束后文件还驻留（粘着）在内存中。</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 3:</span> chmod SUID、SGID和粘着位的八进制值</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">二进制值</th>
<th scope="col" class="org-right">八进制值</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">000</td>
<td class="org-right">0</td>
<td class="org-left">所有位都清零</td>
</tr>

<tr>
<td class="org-right">001</td>
<td class="org-right">1</td>
<td class="org-left">粘着位置位</td>
</tr>

<tr>
<td class="org-right">010</td>
<td class="org-right">2</td>
<td class="org-left">SGID位置位</td>
</tr>

<tr>
<td class="org-right">011</td>
<td class="org-right">3</td>
<td class="org-left">SGID位和粘着位都置位</td>
</tr>

<tr>
<td class="org-right">100</td>
<td class="org-right">4</td>
<td class="org-left">SUID位置位</td>
</tr>

<tr>
<td class="org-right">101</td>
<td class="org-right">5</td>
<td class="org-left">SUID位和粘着位都置位</td>
</tr>

<tr>
<td class="org-right">110</td>
<td class="org-right">6</td>
<td class="org-left">SUID位和SGID都置位</td>
</tr>

<tr>
<td class="org-right">111</td>
<td class="org-right">7</td>
<td class="org-left">所有位都置位</td>
</tr>
</tbody>
</table>

<pre class="example">
//创建一个共享目录
$ mkdir testdir
$ chgrp shared testdir
$ chmod g+s testdir
$ umask 002
$ cd testdir
$ touch testfile

</pre>
</div>
</div>
</div>
<div id="outline-container-org9dfd44c" class="outline-3">
<h3 id="org9dfd44c">管理文件系统</h3>
<div class="outline-text-3" id="text-org9dfd44c">
</div>
<div id="outline-container-org0d3732e" class="outline-4">
<h4 id="org0d3732e">探索 Linux 文件系统</h4>
</div>
<div id="outline-container-orga25d792" class="outline-4">
<h4 id="orga25d792">操作文件系统</h4>
</div>
<div id="outline-container-org28414b6" class="outline-4">
<h4 id="org28414b6">逻辑卷管理</h4>
</div>
</div>
<div id="outline-container-orge76dc99" class="outline-3">
<h3 id="orge76dc99">安装软件程序</h3>
<div class="outline-text-3" id="text-orge76dc99">
<ol class="org-ol">
<li>Linux中广泛使用的两种主要的PMS（package management system）基础工具：dpkg和rpm</li>
<li>基于Debian</li>
<li>apt-get</li>
<li>apt-cache</li>
<li>aptitude</li>
<li>基于Red Hat</li>
<li>yum，在Red Hat和CentOS中使用。</li>
<li>urpm，在Mandriva中使用</li>
<li>zypper，在openSUSE中使用</li>
</ol>
</div>
</div>
<div id="outline-container-orgeefbc0e" class="outline-3">
<h3 id="orgeefbc0e">使用编辑器</h3>
<div class="outline-text-3" id="text-orgeefbc0e">
<ol class="org-ol">
<li>Vim</li>
<li>nano</li>
<li>Emacs</li>
<li>gedit</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orga0b1cf3" class="outline-2">
<h2 id="orga0b1cf3">shell 脚本编程基础</h2>
<div class="outline-text-2" id="text-orga0b1cf3">
</div>
<div id="outline-container-org21988f0" class="outline-3">
<h3 id="org21988f0">构建基本脚本</h3>
<div class="outline-text-3" id="text-org21988f0">
</div>
<div id="outline-container-orgb712c59" class="outline-4">
<h4 id="orgb712c59">创建一个简单的脚本</h4>
<div class="outline-text-4" id="text-orgb712c59">
<div class="org-src-container">
<pre class="src src-shell" id="org80d7c14"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash  #&#21578;&#35785;shell&#29992;/bin/</span><span style="color: #a020f0;">bash&#26469;&#36816;&#34892;&#33050;&#26412;&#12290;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">This script displays the date and who's #&#33050;&#26412;&#29992;&#36884;&#35828;&#26126;&#21450;&#20316;&#32773;&#31561;&#20449;&#24687;&#25551;&#36848; </span>
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"This's is a shell script."</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#28040;&#24687;</span>
<span style="color: #483d8b;">echo</span> -n <span style="color: #8b2252;">"The time and date are: "</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">n&#34920;&#31034;&#22312;&#19968;&#34892;&#26174;&#31034;</span>
date

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"User info for userid: $USER"</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29615;&#22659;&#21464;&#37327;&#65292;&#29992;set&#21629;&#20196;&#21487;&#20197;&#26597;&#30475;&#19968;&#20221;&#23436;&#25972;&#30340;&#24403;&#21069;&#29615;&#22659;&#21464;&#37327;&#21015;&#34920;&#12290;</span>
<span style="color: #483d8b;">echo</span> UID: $<span style="color: #a0522d;">UID</span>
<span style="color: #483d8b;">echo</span> HOME: $<span style="color: #a0522d;">HOME</span>
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The cost of the item is \$15."</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32654;&#20803;&#38656;&#35201;&#20351;&#29992;\&#36716;&#20041;</span>

days = 10 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#25143;&#33258;&#23450;&#20041;&#21464;&#37327;</span>
<span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">days</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26377;&#20004;&#31181;&#26041;&#27861;&#21487;&#20197;&#23558;&#21629;&#20196;&#36171;&#32473;&#21464;&#37327;</span>
<span style="color: #483d8b;">test</span> = <span style="color: #ff00ff;">`date`</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#19968;&#23545;&#21453;&#24341;&#21495;&#25226;&#25972;&#20010;&#21629;&#20196;&#22260;&#36215;&#26469;</span>
<span style="color: #483d8b;">test</span> = $(<span style="color: #ff00ff;">date</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;$()&#26684;&#24335;</span>
today = $(<span style="color: #ff00ff;">date</span>+%y%m%d) <span style="color: #b22222;">#</span><span style="color: #b22222;">today&#21464;&#37327;&#34987;&#36171;&#20104;&#26684;&#24335;&#21270;&#21518;&#30340;date&#21629;&#20196;&#30340;&#36755;&#20986;&#12290;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgaa190b4" class="outline-4">
<h4 id="orgaa190b4">重定向输入和输出</h4>
<div class="outline-text-4" id="text-orgaa190b4">
<pre class="example">
// 输出重定向
$ date &gt; test
$ date &gt;&gt; test

</pre>

<pre class="example">
// 输入重定向
$ wc &lt; test

</pre>
<p>
2 11 60
</p>
<pre class="example">
//wc命令，默认情况下，会输出3个值：

</pre>
<ul class="org-ul">
<li>文本的行数</li>
<li>文本的词数</li>
<li>文本的字节数</li>
</ul>

<pre class="example">
内联输入重定向（inline input redirection）
$ wc &lt;&lt; EOF
shell 会用PS2环境变量中定义的次提示符来提示输入数据

</pre>
</div>
</div>
<div id="outline-container-org0fbaba2" class="outline-4">
<h4 id="org0fbaba2">管道</h4>
<div class="outline-text-4" id="text-org0fbaba2">
<pre class="example">
$ rpm -qa | sort
//上面的命令会同时运行。

</pre>
</div>
</div>
<div id="outline-container-orgc8c5b39" class="outline-4">
<h4 id="orgc8c5b39">执行数学运算</h4>
<div class="outline-text-4" id="text-orgc8c5b39">
<pre class="example">
$ var1=$(1+5)
$ var2=$[$var1 * 2]
// 使用$和[]将数学表达式围起来
注意：bash shell数学运算符支持整数运算。z shell（zsh）提供了完整的浮点数算术操作。

</pre>

<pre class="example">
浮点解决方案
1.用内建的bash计算器：bc
$ bc

</pre>
<p>
3.44 / 5
0
scale = 4 浮点运算由scale控制，默认值为0
</p>
<pre class="example">
// -q选项可以不显示冗长的欢迎信息
$ bc -q 

</pre>
<p>
var1 = 10
var1 * 4
40
var2 = var1 / 5
print var2
2
quit
</p>
<pre class="example">
$

</pre>

<pre class="example">
2. 在脚本中使用bc

</pre>
<div class="org-src-container">
<pre class="src src-shell" id="org8f8207c"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
var1 = $(<span style="color: #ff00ff;">echo</span> <span style="color: #8b2252;">"scale=4;3.44 / 5"</span> | bc)
<span style="color: #483d8b;">echo</span> The answer is $<span style="color: #a0522d;">var1</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell" id="orga1d84ff"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>

var1 = 10.46
var2 = 43.67
var3 = 33.2
var4 = 71

var5 = $(<span style="color: #ff00ff;">bc</span> &lt;&lt; EOF
<span style="color: #ffa54f;">scale =4</span>
<span style="color: #ffa54f;">a1 = ($var1*$var2)</span>
<span style="color: #ffa54f;">a2 = ($var3*var4)</span>
<span style="color: #ffa54f;">a1+b1</span>
<span style="color: #ffa54f;">EOF</span>
)

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The final answer for this mess is $var5"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org5225d89" class="outline-4">
<h4 id="org5225d89">退出脚本</h4>
<div class="outline-text-4" id="text-org5225d89">
<pre class="example">
1. 退出状态码（exit status）
$ echo $?

</pre>
<p>
0
</p>
<table id="org099610b" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">状态码</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">命令成功结束</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">一般性未知错误</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">不适合的shell命令</td>
</tr>

<tr>
<td class="org-right">126</td>
<td class="org-left">命令不可执行</td>
</tr>

<tr>
<td class="org-right">127</td>
<td class="org-left">没找到命令</td>
</tr>

<tr>
<td class="org-right">128</td>
<td class="org-left">无效的退出参数</td>
</tr>

<tr>
<td class="org-right">128+x</td>
<td class="org-left">与Linux信号x相关的严重错误</td>
</tr>

<tr>
<td class="org-right">130</td>
<td class="org-left">通过Ctrl+C终止的命令</td>
</tr>

<tr>
<td class="org-right">255</td>
<td class="org-left">正常范围之外的退出状态码</td>
</tr>
</tbody>
</table>
<pre class="example">
2. exit命令
exit命令允许在脚本结束时指定一个退出状态码

</pre>
<div class="org-src-container">
<pre class="src src-shell" id="org46e3686"><span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'Hello, World'</span>
<span style="color: #a020f0;">exit</span> 5 
</pre>
</div>
<pre class="example">
$ ./test 

</pre>
<p>
Hello, World
</p>
<pre class="example">
$ echo $?

</pre>
<p>
5
</p>
</div>
</div>
</div>
<div id="outline-container-orgbf8c385" class="outline-3">
<h3 id="orgbf8c385">结构化命令</h3>
<div class="outline-text-3" id="text-orgbf8c385">
<div class="org-src-container">
<pre class="src src-shell" id="org57730f4">&#26684;&#24335;&#65306;
<span style="color: #a020f0;">if</span> command1
<span style="color: #a020f0;">then</span>
        commands
<span style="color: #a020f0;">elif</span> command2
<span style="color: #a020f0;">then</span>
        commands
<span style="color: #a020f0;">fi</span>

&#31034;&#20363;&#65306;
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>
testuser = NoSuchUser
<span style="color: #b22222;">#</span>
<span style="color: #a020f0;">if</span> grep $<span style="color: #a0522d;">testuser</span> /etc/passwd
<span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The bash files for user $testuser are:"</span>
    ls -a /home/$<span style="color: #a0522d;">testuser</span>/.b*
    <span style="color: #483d8b;">echo</span>
<span style="color: #a020f0;">elif</span> ls -d /home/$<span style="color: #a0522d;">testuser</span>
<span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The user $testuser has a directory"</span>
<span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The user $testuser does not exist on this system."</span>
    <span style="color: #483d8b;">echo</span>
<span style="color: #a020f0;">fi</span>

<span style="color: #483d8b;">test</span>&#21629;&#20196;&#25552;&#20379;&#20102;&#22312;if-then&#35821;&#21477;&#20013;&#27979;&#35797;&#19981;&#21516;&#26465;&#20214;&#30340;&#36884;&#24452;&#12290;
<span style="color: #483d8b;">test</span>&#21629;&#20196;&#21487;&#20197;&#21028;&#26029;&#19977;&#31867;&#26465;&#20214;&#65306;&#25968;&#20540;&#27604;&#36739;&#65307;&#23383;&#31526;&#20018;&#27604;&#36739;&#65307;&#25991;&#20214;&#27604;&#36739;
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>
$<span style="color: #a0522d;">var</span> = 10
<span style="color: #a020f0;">if</span> [$<span style="color: #a0522d;">var</span> -eq 5]
<span style="color: #a020f0;">then</span> 
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The value $var are equal."</span>
<span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The value $var are different."</span>
<span style="color: #a020f0;">fi</span>
$<span style="color: #a0522d;">var1</span> = baduser
<span style="color: #a020f0;">if</span> [$<span style="color: #a0522d;">USER</span> != $<span style="color: #a0522d;">var1</span>]
<span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"This is not $var1"</span>
<span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Welcome $var"</span>
<span style="color: #a020f0;">fi</span>
$<span style="color: #a0522d;">var2</span> = baseall
$<span style="color: #a0522d;">var3</span> = hockey
<span style="color: #a020f0;">if</span> [$<span style="color: #a0522d;">var2</span> <span style="color: #8b2252;">\&gt;</span> $<span style="color: #a0522d;">var3</span>] <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;&#31526;&#21495;&#38656;&#35201;&#36716;&#20041;&#65292;&#38450;&#27490;&#35299;&#37322;&#25104;&#36755;&#20986;&#37325;&#23450;&#21521;</span>
<span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$var2 is greater than $var3"</span>
<span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$var2 is less than $var3"</span>
<span style="color: #a020f0;">fi</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org9fda71c" class="outline-3">
<h3 id="org9fda71c">处理用户输入</h3>
</div>
<div id="outline-container-org1b45c7d" class="outline-3">
<h3 id="org1b45c7d">呈现数据</h3>
</div>
<div id="outline-container-org9ae4abb" class="outline-3">
<h3 id="org9ae4abb">控制脚本</h3>
</div>
</div>
<div id="outline-container-org1833e48" class="outline-2">
<h2 id="org1833e48">高级 shell 脚本编程</h2>
<div class="outline-text-2" id="text-org1833e48">
</div>
<div id="outline-container-orgef6802f" class="outline-3">
<h3 id="orgef6802f">创建函数</h3>
</div>
<div id="outline-container-org0a9a882" class="outline-3">
<h3 id="org0a9a882">图形化桌面环境中的脚本编程</h3>
</div>
<div id="outline-container-org4af42a8" class="outline-3">
<h3 id="org4af42a8">初识 sed 和 gawk</h3>
</div>
<div id="outline-container-orgd8c9651" class="outline-3">
<h3 id="orgd8c9651">正则表达式</h3>
</div>
<div id="outline-container-org6308f4c" class="outline-3">
<h3 id="org6308f4c">sed 和 gawk 进阶</h3>
</div>
<div id="outline-container-org870c881" class="outline-3">
<h3 id="org870c881">使用其他 shell</h3>
</div>
</div>
<div id="outline-container-org34d4ebf" class="outline-2">
<h2 id="org34d4ebf">创建实用的脚本</h2>
<div class="outline-text-2" id="text-org34d4ebf">
</div>
<div id="outline-container-org3dc0f2f" class="outline-3">
<h3 id="org3dc0f2f">编写简单的脚本实用工具</h3>
<div class="outline-text-3" id="text-org3dc0f2f">
</div>
<div id="outline-container-orge3fb219" class="outline-4">
<h4 id="orge3fb219">归档</h4>
</div>
<div id="outline-container-orga4bc113" class="outline-4">
<h4 id="orga4bc113">管理用户账户</h4>
</div>
<div id="outline-container-orgc499294" class="outline-4">
<h4 id="orgc499294">检测磁盘空间</h4>
</div>
</div>
<div id="outline-container-org9309780" class="outline-3">
<h3 id="org9309780">创建与数据库、Web及E-Mail相关的脚本</h3>
</div>
<div id="outline-container-orgdb59af6" class="outline-3">
<h3 id="orgdb59af6">一些小意思的脚本</h3>
<div class="outline-text-3" id="text-orgdb59af6">
</div>
<div id="outline-container-orga9385b9" class="outline-4">
<h4 id="orga9385b9">发送消息</h4>
</div>
<div id="outline-container-orgc4a79bb" class="outline-4">
<h4 id="orgc4a79bb">获取格言</h4>
</div>
<div id="outline-container-org03fe2e5" class="outline-4">
<h4 id="org03fe2e5">编造借口</h4>
</div>
<div id="outline-container-orgbaa3c62" class="outline-4">
<h4 id="orgbaa3c62">在当前目录及指定子目录深度下创建.gitignore文件</h4>
<div class="outline-text-4" id="text-orgbaa3c62">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">sh</span>
<span style="color: #a020f0;">for</span> dir<span style="color: #a020f0;"> in</span> <span style="color: #ff00ff;">`find ./ -mindepth 2 -maxdepth 4 -type d`</span>
<span style="color: #a020f0;">do</span>
        <span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">dir</span>
        <span style="color: #ff00ff;">`touch $dir/.gitignore`</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"*"</span>&gt;$<span style="color: #a0522d;">dir</span>/.gitignore
<span style="color: #a020f0;">done</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf6f2f53" class="outline-4">
<h4 id="orgf6f2f53">解决 dpkg: warning: files list file for package 'x' missing</h4>
<div class="outline-text-4" id="text-orgf6f2f53">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span></label><pre class="src src-shell"><span style="color: #a020f0;">for</span> package<span style="color: #a020f0;"> in</span> $(<span style="color: #ff00ff;">sudo</span> apt install catdoc 2&amp;1 |grep <span style="color: #8b2252;">"warning: files list file for package'"</span> |grep -Po <span style="color: #8b2252;">"[^'\n ]+'"</span> |grep -Po <span style="color: #8b2252;">"[^']+"</span>);
<span style="color: #a020f0;">do</span>
        sudo apt install --reinstall <span style="color: #8b2252;">"$package"</span>
<span style="color: #a020f0;">done</span>
</pre>
</div>
</div>
</div>
</div>
</div>
